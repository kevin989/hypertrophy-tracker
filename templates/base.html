<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title if title else 'Hypertrophy Tracker' }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Utility helpers (on top of Tailwind) */
    .card { @apply bg-white shadow-md rounded-2xl p-5 border border-slate-100; }
    .btn  { @apply inline-flex items-center justify-center px-3.5 py-2 rounded-xl text-sm font-medium transition;
            @apply bg-indigo-600 text-white hover:bg-indigo-700 active:bg-indigo-800; }
    .btn-secondary { @apply inline-flex items-center justify-center px-3 py-1.5 rounded-xl text-sm font-medium
                     bg-slate-100 text-slate-700 hover:bg-slate-200 active:bg-slate-300; }
    .btn-ghost { @apply inline-flex items-center px-3 py-1.5 rounded-xl text-sm text-slate-300 hover:text-white hover:bg-white/10; }
    .input { @apply w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none
             focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500; }
    .table { @apply w-full border-collapse text-sm; }
    .table th { @apply text-left bg-slate-50 border-b border-slate-200 px-3 py-2 font-semibold text-slate-700; }
    .table td { @apply border-b border-slate-100 px-3 py-2; }
    .badge { @apply inline-flex items-center rounded-full bg-slate-100 text-slate-700 px-2 py-0.5 text-xs font-medium; }
    .container { @apply max-w-6xl mx-auto px-4; }
    .nav-link { @apply text-slate-300 hover:text-white transition; }
    .active-link { @apply text-white font-semibold; }
    .nav-btn { @apply hidden md:inline-flex; }
    .mobile-only { @apply md:hidden; }
    .desktop-only { @apply hidden md:flex; }
    .divider { @apply h-px bg-slate-200 my-4; }
  </style>
</head>

<body class="bg-slate-50 text-slate-800">
  <!-- Sticky top nav -->
  <header class="sticky top-0 z-40 bg-slate-900/95 backdrop-blur supports-[backdrop-filter]:bg-slate-900/75 border-b border-slate-800">
    <div class="container h-14 flex items-center justify-between">
      <!-- Left: Brand -->
      <a href="{{ url_for('dashboard') }}" class="flex items-center gap-2">
        <div class="h-7 w-7 rounded-lg bg-indigo-600 grid place-items-center text-white text-xs font-bold">HT</div>
        <span class="text-white font-semibold">Hypertrophy Tracker</span>
      </a>

      <!-- Right: Primary nav -->
      <nav class="desktop-only items-center gap-2">
        <a class="btn-ghost {{ 'active-link' if request.endpoint=='dashboard' else '' }}" href="{{ url_for('dashboard') }}">Dashboard</a>
        <a class="btn-ghost {{ 'active-link' if request.endpoint=='rm_test' else '' }}" href="{{ url_for('rm_test') }}">RM Test</a>
        <a class="btn-ghost {{ 'active-link' if request.endpoint=='settings' else '' }}" href="{{ url_for('settings') }}">Settings</a>
        <a class="btn-ghost" href="{{ url_for('export_xlsx') }}">Export</a>

        <!-- Weeks dropdown -->
        <div class="relative">
          <button id="weeksBtn" class="btn-ghost">Weeks ▾</button>
          <div id="weeksMenu" class="hidden absolute right-0 mt-2 w-56 rounded-xl border border-slate-800 bg-slate-900 shadow-lg p-2">
            <div class="grid grid-cols-3 gap-1">
              {% for w in range(1,13) %}
                <a class="text-slate-300 hover:text-white hover:bg-white/10 rounded-lg px-2 py-1 text-sm {{ 'active-link' if request.view_args and request.view_args.get('week')==w else '' }}"
                   href="{{ url_for('week_view', week=w) }}">W{{ w }}</a>
              {% endfor %}
            </div>
          </div>
        </div>

        {% if session.get('authed') %}
          <a class="btn ml-2" href="{{ url_for('logout') }}">Logout</a>
        {% else %}
          <a class="btn ml-2" href="{{ url_for('login') }}">Login</a>
        {% endif %}
      </nav>

      <!-- Mobile menu button -->
      <button id="mobileMenuBtn" class="mobile-only text-slate-300 hover:text-white">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    <!-- Mobile menu -->
    <div id="mobileMenu" class="mobile-only hidden border-t border-slate-800">
      <div class="container py-2 grid grid-cols-2 gap-2">
        <a class="btn-secondary" href="{{ url_for('dashboard') }}">Dashboard</a>
        <a class="btn-secondary" href="{{ url_for('rm_test') }}">RM Test</a>
        <a class="btn-secondary" href="{{ url_for('settings') }}">Settings</a>
        <a class="btn-secondary" href="{{ url_for('export_xlsx') }}">Export</a>
        <div class="col-span-2">
          <div class="font-semibold text-slate-300 mb-1">Weeks</div>
          <div class="grid grid-cols-6 gap-1">
            {% for w in range(1,13) %}
              <a class="btn-secondary text-center" href="{{ url_for('week_view', week=w) }}">W{{ w }}</a>
            {% endfor %}
          </div>
        </div>
        <div class="col-span-2">
          {% if session.get('authed') %}
            <a class="btn w-full" href="{{ url_for('logout') }}">Logout</a>
          {% else %}
            <a class="btn w-full" href="{{ url_for('login') }}">Login</a>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <main class="container py-6">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-4 space-y-2">
          {% for category, message in messages %}
            <div class="p-3 rounded-xl
                        {{ 'bg-green-50 text-green-800 border border-green-200' if category=='success'
                           else 'bg-rose-50 text-rose-800 border border-rose-200' }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <footer class="border-t border-slate-200 py-6 mt-12">
    <div class="container text-xs text-slate-500">
      Built for progressive overload & hypertrophy • {{ request.host }}
    </div>
  </footer>

  <script>
    // Weeks dropdown (desktop)
    const weeksBtn = document.getElementById('weeksBtn');
    const weeksMenu = document.getElementById('weeksMenu');
    if (weeksBtn) {
      weeksBtn.addEventListener('click', () => {
        weeksMenu.classList.toggle('hidden');
      });
      document.addEventListener('click', (e) => {
        if (!weeksBtn.contains(e.target) && !weeksMenu.contains(e.target)) {
          weeksMenu.classList.add('hidden');
        }
      });
    }

    // Mobile menu toggle
    const mobileBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    if (mobileBtn) {
      mobileBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }
  </script>
</body>
</html>
