{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-xl font-semibold">History ({{ year }}-{{ "%02d"|format(month) }})</h2>
    <div class="space-x-2">
      <a class="btn-secondary" href="{{ url_for('history', y=year if month>1 else year-1, m=month-1 if month>1 else 12) }}">Prev</a>
      <a class="btn-secondary" href="{{ url_for('history', y=year if month<12 else year+1, m=month+1 if month<12 else 1) }}">Next</a>
    </div>
  </div>

  <div class="grid grid-cols-7 gap-2">
    <div class="badge">Sun</div><div class="badge">Mon</div><div class="badge">Tue</div><div class="badge">Wed</div>
    <div class="badge">Thu</div><div class="badge">Fri</div><div class="badge">Sat</div>

    {% set first = (year ~ "-" ~ ("%02d"|format(month)) ~ "-01") | todatetime %}
    {% set start_wday = first.isoweekday() %} {# 1..7 Mon..Sun #}

    {# pad so Sunday is col 1 #}
    {% for _ in range((start_wday % 7)) %}<div></div>{% endfor %}

    {% for d in range(1, days+1) %}
      {% set sess_list = by_day.get(d) %}
      <div class="card" style="padding:.5rem">
        <div class="flex items-center justify-between">
          <span class="text-sm font-semibold">{{ d }}</span>
          {% if sess_list %}<span class="badge">✔</span>{% endif %}
        </div>
        {% if sess_list %}
          {% for sess in sess_list %}
            <div class="text-xs text-slate-600 mt-1">
              Week {{ sess.week }}, Day {{ sess.day }}
              {% if sess.duration_seconds %} • {{ (sess.duration_seconds // 60) }}m{% endif %}
            </div>
          {% endfor %}
          <a class="btn-secondary mt-2" href="{{ url_for('history_day', y=year, m=month, d=d) }}">View</a>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
