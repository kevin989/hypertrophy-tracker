{% extends "base.html" %}
{% block content %}
<form method="post">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
    <div class="card">
      <label class="block text-sm text-gray-600">Body Weight ({{ units }})</label>
      <input class="input w-40" type="number" step="0.1" name="bodyweight" value="{{ bw if bw else '' }}">
      <button class="btn mt-3" type="submit">Save Week {{ week }}</button>
    </div>
    <div class="card">
      <h3 class="text-lg font-semibold mb-2">Notes</h3>
      <p class="text-sm text-gray-600">Enter set reps below. For accessories, last set is AMRAP; weights increment if AMRAP meets threshold.</p>
    </div>
  </div>

  {% for day_title, sub in grouped %}
    <div class="card mb-6">
      <h3 class="text-lg font-semibold mb-2">{{ day_title }}</h3>
      {% if sub|length == 0 %}
      {% if 'Rest' in day_title %}<span class="badge ml-2">Recovery</span>{% endif %}
        <p class="text-gray-500">Rest day.</p>
      {% else %}
      <div class="overflow-x-auto">
      <table class="table">
      <thead>
        <tr>
          <th>Exercise</th>
          <th>Sets</th>
          <th>Rep Target</th>
          <th>Suggested ({{ units }})</th>
          <th>Load (this week, {{ units }})</th>
          <th>S1</th>
          <th>S2</th>
          <th>S3</th>
          <th>New Load ({{ units }})</th>
          <th>Notes</th>
        </tr>
      </thead>
        <tbody>
          {% for r in sub %}
          <tr class="{{ 'bg-white' if loop.index is odd else 'bg-slate-50' }}">
            <td>{{ r.exercise }}</td>
            <td>{{ r.sets }}</td>

            <!-- Rep Target: add '+' for accessories to indicate final set is AMRAP -->
            <td>
              {% if r.category == 'accessory' %}
                {{ r.rep_low }}–{{ r.rep_high }}+
              {% else %}
                {{ r.rep_low }}–{{ r.rep_high }}
              {% endif %}
            </td>

            <!-- Suggested load (read-only) -->
            <td>{{ r.load_last if r.load_last is not none else '' }}</td>

            <!-- Actual load used this week (input) -->
            <td>
              <input class="input w-24" type="number" step="0.5"
                    name="row_{{ r.id }}_load"
                    placeholder="{{ r.load_last if r.load_last is not none else '' }}">
            </td>

            <td><input class="input w-16" type="number" name="row_{{ r.id }}_s1" min="0" step="1"></td>
            <td><input class="input w-16" type="number" name="row_{{ r.id }}_s2" min="0" step="1"></td>

            <!-- S3 is the AMRAP set for accessories; for compounds it's just the 3rd set -->
            <td><input class="input w-16" type="number" name="row_{{ r.id }}_s3" min="0" step="1"
                      placeholder="{% if r.category == 'accessory' %}AMRAP{% endif %}"></td>

            <td>{{ r.new_load if r.new_load is not none else '' }}</td>
            <td><input class="input" type="text" name="row_{{ r.id }}_notes"></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
      {% endif %}
    </div>
  {% endfor %}
  <div class="mb-10">
    <button class="btn" type="submit">Save Week {{ week }}</button>
  </div>
</form>
{% endblock %}
